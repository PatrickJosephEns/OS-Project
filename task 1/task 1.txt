#!/bin/bash
dpath="$1"

#http://kate.ict.op.ac.nz/~faisalh/IN616osc/legends.txt

if [ -z "$1" ]; then
    echo "Please enter the file source path or link:"
    read dpath

    if [[ $dpath == "http"* ]]; then
        wget $dpath
        $dpath = "legends.txt"
    fi
fi

#user:encrypted password:uid,gid: name:groups: home directory:prefered shell
while IFS=: read -r username password uid gid name groups directory preferedshell
do 

#check if user exists
 if id -u user >/dev/null 2>&1; then
    echo -r "$username already exists ... \n Skipping user."
 else

    for i in $(echo $groups | tr "," "\n")
    do
        if [ $(getent group $i) -eq 0]; then
            groupadd $i
        fi
    done

    echo -r "Adding user $username ..."
    useradd -g "$groups" -d "$directory" -s "$preferedshell" -c $name -p "$(echo "$password" | openssl passwd -1 -stdin)" $username
    passwd -e $username # forces user to change password in next login
 fi
done < $dpath



